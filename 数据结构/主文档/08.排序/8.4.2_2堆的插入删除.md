# 堆排序与堆数据结构操作

## 摘要

本笔记系统解析堆数据结构中插入与删除操作的核心机制，量化分析调整过程中的关键字对比次数，提供典型实例与考试重点映射，满足计算机组成原理课程学习与应试需求。

---

## 主题

**堆操作的核心方法**：通过上升/下坠调整维护堆性质，重点控制时间复杂度  
**关键词**：大根堆、小根堆、上升调整（Percolate Up）、下坠调整（Percolate Down）、关键字对比次数  
**问题提示**：删除操作时为何必须用堆底元素替换？下坠调整为何需要更多对比？

> **重点难点**
>
> - 插入后上升路径的终止条件判定
> - 下坠调整时的分支选择逻辑（双子节点场景）
> - 时间复杂度与关键字对比次数的映射关系

---

## 线索区

### 知识点 1：堆插入操作

**定义**  
将新元素置于堆数组末尾，通过**逐级比较-交换**使其在完全二叉树中上浮至合法位置

**原理公式**  
设插入位置索引为$i$，大根堆调整条件：  
$$ \text{while } i>1 \text{ and } heap[i] > heap[\lfloor i/2 \rfloor]: \\ \quad swap(heap[i], heap[\lfloor i/2 \rfloor]) \\ \quad i = \lfloor i/2 \rfloor $$

> **实例分析**

- 插入 13：触发 3 次对比（13→15→28→31），最终停留于第 3 层
- 插入 46：直接保留在堆底（46 < 父节点值）

> **技术参数**

- **最佳情况**：0 次对比（直接插入）
- **最坏情况**：$\lfloor \log_2n \rfloor$次对比

---

### 知识点 2：堆删除操作

**定义**  
用堆末元素替换根节点，通过**逐级比较-下沉**重构堆结构

> **调整逻辑**

1. 比较当前节点与左右子节点
2. 选择最大（大根堆）/最小（小根堆）子节点
3. **双子节点存在时需 2 次对比**（先兄弟对比，再父子对比）

> **典型案例**

- 删除 13：用 46 替换后触发 4 次对比（46→15→28→31→ 调整终止）
- 删除 65：直接移除根节点（替换元素无需调整）

> **复杂度特征**

- **下坠深度**：最多$\lfloor \log_2n \rfloor$层
- **单层对比次数**：1（单子节点）或 2（双子节点）

---

## 总结区

### 操作对比表

| 维度       | 插入操作         | 删除操作              |
| ---------- | ---------------- | --------------------- |
| 触发条件   | 新元素入堆       | 移除堆顶元素          |
| 调整方向   | 自底向上（上升） | 自顶向下（下坠）      |
| 关键对比点 | 父子节点单路比较 | 父子+兄弟节点多路比较 |
| 时间复杂度 | O(log n)         | O(log n)              |

### 考试重点

1. **对比次数计算**（尤其注意删除操作的双子节点场景）
   - 示例：高度为 4 的堆，最多需要$2 \times (4-1)=6$次对比
2. **调整终止条件**的边界判断
3. 堆排序过程中操作次数的累计计算

### 实践建议

1. 用数组索引规律加速计算：
   - 父节点索引 = $\lfloor i/2 \rfloor$
   - 左子节点索引 = $2i$
   - 右子节点索引 = $2i+1$
2. 调试时绘制完全二叉树辅助验证

---

请确认是否需要增加特定场景的复杂度计算示例，或扩展与堆排序的关联分析。
