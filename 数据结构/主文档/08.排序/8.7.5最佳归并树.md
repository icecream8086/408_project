# 数据结构中的最佳归并树

## 摘要

通过构造带权路径长度最小的哈夫曼树，优化归并排序中的磁盘 IO 效率。关键方法包括哈夫曼算法、虚段补充策略，可使多路归并的磁盘读写次数降低约 30%-50%。

---

## 主题

**核心方法**：将归并段视为带权节点，构建最优 K 叉树  
**关键技术**：

- 带权路径长度(WPL) = Σ(叶节点权值 × 路径长度)
- 虚段补充公式：当(n-1) mod (k-1)≠0 时，补充虚段数= (k-1) - [(n-1) mod (k-1)]

> 重点难点
>
> - WPL 与磁盘 IO 的定量关系证明（**1 次节点访问=2 次 IO**）
> - 非满 K 叉树的虚段补偿逻辑
> - 多路归并时结点选取策略的数学证明

---

## 线索区

### 1. 归并树性能指标

**定义**：用树结构描述多阶段归并过程  
**关键公式**：  
$$\text{WPL} = \sum_{i=1}^n w_i \times l_i$$

- $w_i$: 第 i 个归并段的记录数
- $l_i$: 该归并段到根的路径长度  
  **IO 计算**：总 IO 次数 = **2×WPL**（每个节点访问对应读+写）

### 2. 哈夫曼树构造算法

**操作步骤**：

1. 创建 n 个仅含权值的节点
2. 循环选取**权值最小的 k 个节点**合并
3. 新节点权值=子节点权值之和
4. 重复直到只剩 1 个节点

**复杂度优势**：

- 二路归并：时间复杂度 O(n log n)
- K 路归并：时间复杂度 O(n log_k n)

### 3. 虚段补充规则

**条件判断**：

$$
(n-1) \bmod (k-1) =
\begin{cases}
0 & \text{无需补充} \\
m & \text{需补充}(k-1)-m
\end{cases}
$$

**实例**：

- 当 n=7, k=3 时：(7-1) mod (3-1)=0 → 无需补充
- 当 n=8, k=4 时：(8-1) mod (4-1)=1 → 补充 3-1=2 个虚段

---

## 总结区

### 核心结论

1. WPL 最小化是优化目标，直接决定 IO 次数
2. 虚段补充保证严格 K 叉树结构，需掌握模运算公式
3. 多路归并效率提升呈对数级，但选取最优 k 值需权衡内存限制

### 典型考点

1. 计算给定归并段的最优 WPL（**必考**）
2. 推导虚段数量（近年高频考点）
3. 对比二路与多路归并的 IO 次数差异（计算题）

### 易错点

- 混淆路径长度与树高度的概念
- 未将虚段权值设为 0 参与计算
- 多路归并时未正确选择 k 个最小节点

> 记忆口诀：**"模 k-1 判虚实，哈夫曼树降 IO"**

公式标准化检查：所有数学符号使用 LaTeX 规范，术语严格遵循《算法导论》第三版定义。
