# 主存优化技术：双端口 RAM 与多模块存储器

## 摘要

通过双端口 RAM 实现多核 CPU 并行访问，采用多模块存储器提升单核 CPU 存取效率。核心方法包括交叉编制策略与流水线式存取，实现**内存吞吐量提升 2 倍**的关键效果。实验表明低位交叉编制相比高位编制可缩短**30%访问延迟**。

## 主题

优化内存子系统性能的两大技术路径：

- **并行访问**：双端口 RAM 架构（多核场景）
- **流水线优化**：多模块交叉编制（单核场景）

> 重点难点
>
> - 双端口 RAM 的地址冲突检测机制
> - 低位交叉编制的编址公式推导
> - 存储体数量与存取周期的数学关系

## 线索区

### 双端口 RAM

**定义**：支持双控制端口的存储器件，允许两个独立总线系统并发操作  
**电路特性**：

- 两套独立接口：`ADDR_A/B`, `DATA_A/B`, `CTRL_A/B`
- 冲突检测电路：当`ADDR_A = ADDR_B`且均为写操作时触发仲裁

**应用场景**：

- 多核 CPU 共享内存
- 显示控制器与处理器协同工作

> 类比：类似双车道收费站，两车可同时通过不同通道（地址），但同一通道（地址）需排队（仲裁）

### 交叉编制策略

#### 高位交叉（顺序编制）

- 编址公式：  
  $$\text{存储体号} = \lfloor \frac{地址}{m} \rfloor$$  
  其中 m 为单个存储体容量
- 缺陷：连续访问同一存储体时产生**恢复时间瓶颈**

#### 低位交叉（交错编制）

- 编址公式：  
  $$\text{存储体号} = 地址 \mod m$$  
  其中 m 为存储体总数
- 优势：将连续地址分散到不同存储体，实现**流水线式访问**

![编址对比]()

### 流水线式存取

**时序约束**：  
$$m \geq \frac{t}{r}$$

- `t`：DRAM 存取周期（典型值**60ns**）
- `r`：总线传输周期（典型值**10ns**）

**最优配置**：  
当`m = t/r = 6`时，理论带宽提升**6 倍**  
实际工程中常采用 4 体交叉（考虑成本与散热）

### 双通道内存实现

**硬件配置**：

- 2 个物理存储体（DIMM 插槽）
- 低位交叉编址（地址 bit[0]决定通道）

**性能验证**：  

| 模式 | 理论带宽 | 实测提升 |
|----------|----------|----------|
| 单通道 | 21.3GB/s | Baseline |
| 双通道 | 42.6GB/s | +89% |

> 配置要点：内存条必须插入**同色插槽**实现低位交叉

## 总结区

**技术对比**：  

| 技术 | 适用场景 | 核心优势 | 典型提升 |
|--------------|-------------|-----------------------|--------|
| 双端口 RAM | 多核系统 | 零延迟并行访问 | 30-40% |
| 低位交叉编制 | 单核连续访问 | 隐藏存储体恢复时间 | 6× 带宽 |
| 双通道内存 | 消费级 PC | 低成本提升吞吐量 | 89% |

**考点聚焦**：

1. 交叉编制公式计算（2021 年 408 真题第 17 题）
2. 双端口冲突场景判断（2020 年真题大题）
3. 存储体最小数量推导（2019 年计算题）

**实验验证建议**：

- 使用 MemTest86 测试不同通道配置的带宽
- 通过 CPU-Z 验证交叉编址模式（单/双通道）


[3.3主存储器与CPU的连接](3.3主存储器与CPU的连接.md)

[3.6虚拟存储器](3.6虚拟存储器.md)
