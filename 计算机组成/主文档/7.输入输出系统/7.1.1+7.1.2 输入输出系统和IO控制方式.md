# 输入输出系统与 IO 控制方式

## 摘要

研究计算机主机与外部设备的数据交互机制，对比分析四种 IO 控制方式（程序查询/中断/DMA/通道）的技术原理与性能特征。通过量化参数对比与架构演进分析，揭示不同场景下的最优控制策略选择依据。

---

## 主题

输入输出系统通过分层控制架构实现设备管理，核心矛盾是**CPU 利用率**与**数据传输效率**的平衡。技术演进路径：轮询检测 → 中断驱动 → 硬件直连 → 智能通道控制，最终实现 CPU 与 IO 操作的解耦。

> 重点难点
>
> - **中断响应延迟计算**：中断周期=保存现场时间+服务程序执行时间
> - **DMA 传输瓶颈**：总线竞争冲突（需仲裁机制）
> - **通道类型辨析**：选择通道（独占式）vs 数组多路通道（分时复用）

---

## 线索区

### 知识点 1：IO 接口核心组件

**定义**：实现信号转换、时序协调的硬件模块  
**功能单元**：

1. 数据缓冲寄存器（**DBR**）→ 解决速度失配
2. 设备状态寄存器（**DSR**）→ 标志位：BUSY/READY/ERROR
3. 控制逻辑电路 → 译码 CPU 命令，生成设备控制信号

**电气特性**：

- 输入端口需设置**三态门**防止总线冲突
- 输出端口配置锁存器保持信号稳定

---

### 知识点 2：控制方式演进对比

| 控制方式 | CPU 介入程度 | 适用场景       | 典型延迟         |
| -------- | ------------ | -------------- | ---------------- |
| 程序查询 | 100%         | 低速设备       | T∝n（轮询次数）  |
| 中断驱动 | 仅状态切换   | 中速设备       | **μs 级**        |
| **DMA**  | 仅初始设置   | 块设备（磁盘） | **总线周期级**   |
| 通道控制 | 0%           | 设备集群       | 通道程序执行时间 |

**关键技术点**：

- DMA 传输阶段：

  1. 预处理（设置地址/计数器）
  2. **突发传输**（占用总线周期）
  3. 后处理（中断通知 CPU）

- 通道工作流程：  
  CPU 发送**IO 指令** → 通道读取**通道程序** → 执行通道指令 → 发送完成中断

---

### 知识点 3：指令系统差异

**IO 指令（CPU 视角）**：

```assembly
IN AL, 60h  ; 从端口60h读取数据到AL寄存器
OUT 64h, AX ; 将AX数据写入端口64h
```

- 操作对象：端口地址空间（独立编址 vs 统一编址）
- 执行主体：CPU

**通道指令（设备视角）**：

- 包含操作码/内存地址/计数/设备号
- 组成**通道程序**存放于主存
- 执行主体：通道处理器

---

## 总结区

**核心考点**：

1. 中断方式下 CPU 利用率公式：  
   $$ U = \frac{T*{service}}{T*{interval}} $$  
   （$T_{interval}$：中断请求平均间隔时间）

2. DMA 与中断的本质区别：
   - 中断：**数据单位**为字/字节
   - DMA：**数据单位**为数据块

**典型问题**：

- 给定设备传输速率，计算 DMA 周期窃取比例
- 分析多级中断嵌套时的优先级反转风险
- 对比内存映射 IO 与端口映射 IO 的优缺点

**技术演进启示**：  
从程序查询到通道控制的演进过程，本质是**硬件复杂度**与**系统效率**的权衡过程，符合计算机体系结构的并行化发展趋势。
