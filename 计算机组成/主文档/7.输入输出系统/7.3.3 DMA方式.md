# DMA 控制方式详解

## 摘要

通过 DMA 控制器实现设备与内存直接数据传输，减少 CPU 干预。核心机制包括总线控制、寄存器组协同和中断通知，传输效率比中断方式提升**3-10 倍**。重点解决总线仲裁、周期窃取和突发传输等关键技术问题。

## 主题

直接内存访问技术体系与实现架构（IEEE Std 1014-1987）

> 重点难点
>
> - 总线仲裁的三种实现方式
> - 周期窃取对 CPU 性能的影响
> - 突发传输与单周期传输的时序差异

## 线索区

### 1. DMA 核心架构

#### 定义

专用控制器实现外设与内存的直连数据传输（Direct Memory Access）

#### 电路结构

```plaintext
[设备接口] ↔ [DMA控制器]
    ├── AR（地址寄存器）: 32bit
    ├── WC（字计数器）: 16bit
    └── CSR（控制状态寄存器）: 8bit
```

#### 工作流程

1. CPU 初始化 AR/WC 寄存器
2. 设备发出 DREQ 请求
3. 总线仲裁（BR/BG 机制）
4. 数据突发传输（burst transfer）
5. 中断通知（EOP 信号）

### 2. 总线控制机制

#### 三态控制逻辑

- **正常态**：CPU 控制总线
- **请求态**：DMA 发送 HRQ 信号
- **应答态**：CPU 回复 HLDA 信号

#### 时序方程

传输周期 = max(设备周期, 内存周期) + 总线切换延迟  
（典型值：**1.5~3 个时钟周期**）

### 3. 访存冲突解决方案

| 方案     | 原理                       | 延迟代价     |
| -------- | -------------------------- | ------------ |
| 周期窃取 | 利用 CPU 空闲总线周期      | 0.5-1 周期   |
| 交替访问 | 分时复用总线（时间片轮转） | 固定周期开销 |
| 透明传输 | 利用 CPU 不访存周期        | 随机等待     |

### 4. 性能对比分析

$$
传输效率比 = \frac{T_{DMA}}{T_{中断}} = \frac{n \cdot t_c}{n \cdot (t_s + t_c) + t_{overhead}}
$$

- $t_c$: 单字传输时间
- $t_s$: 中断服务时间
- $n$: 传输字数

## 总结区

**核心考点**：

1. 总线仲裁流程（BR→BG→HLDA）
2. 寄存器组作用及初始化要求
3. 传输模式选择（单周期/突发）

**典型问题**：

- 给定系统参数计算 DMA 传输效率
- 分析特定总线架构下的冲突解决方案
- 比较不同 DMA 实现方案（如 Flyby 与 Block 模式）

**实现案例**：
Intel 8237DMA 控制器采用**fly-by 传输模式**，支持级联操作，最大传输速率**1.6MB/s**（8MHz 时钟）
