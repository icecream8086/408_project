# 中断处理与优先级管理

## 摘要

本笔记总结了中断处理的基本概念、优先级管理、硬件排队器的工作原理以及中断服务程序的执行流程。重点讨论了CPU如何判断中断状态、中断优先级的设计原则、中断服务程序的入口地址确定及其执行过程。

## 主题

中断处理的核心在于CPU如何响应外部设备的中断请求，并通过硬件和软件机制确定中断的优先级。硬件排队器用于快速判断中断优先级，而中断服务程序的执行流程包括保护现场、处理中断请求、恢复现场和开中断。

> 重点难点
>
> - 中断优先级的设计原则：硬件故障 > 非屏蔽中断 > DMA请求 > I/O设备中断。
> - 硬件排队器的工作原理：通过飞门和宇门的组合处理中断信号，优先级更高的中断源优先输出1。
> - 中断服务程序的执行流程：保护现场、处理中断请求、恢复现场、开中断。

## 线索区

### 知识点1：中断优先级与硬件排队器
- **中断优先级**：最左边的中断源信号优先级最高，越往右优先级越低。当多个中断请求信号同时到来时，CPU会优先响应最高优先级的中断源。
- **硬件排队器**：通过飞门和宇门的组合处理中断信号，优先级更高的中断源会优先输出1，而优先级较低的中断源输出为0。硬件排队器用于快速判断中断优先级，而软件实现的中断优先级判断较慢。

### 知识点2：中断优先级的设计原则
- **硬件故障**相关的中断信号优先级最高，其次是软件中断。
- **非屏蔽中断**优于可屏蔽中断，非屏蔽中断通常是非常紧急的信号。
- **DMA请求**优于I/O设备的中断请求，高速设备的中断信号优于低速设备。
- **输入设备**的优先级高于输出设备，因为输入设备的数据可能会丢失。

### 知识点3：中断服务程序的执行流程
- **保护现场**：保存之前程序的CPU环境（寄存器值），确保中断结束后程序能继续使用之前的中间结果。
- **处理中断请求**：具体内容因中断类型而异，如键盘输入、打印机输出等。
- **恢复现场**：将之前保存的寄存器值恢复到CPU中。
- **开中断**：执行开中断指令，PC值指回程序原来的执行位置。

### 知识点4：中断向量与中断处理程序
- **中断向量**：指向中断服务程序入口地址的指针，通过硬件项量法确定中断服务程序的起始地址。
- **中断向量地址形成部件**：根据中断请求信号生成中断向量的存储地址，从而找到中断服务程序的入口地址。
- **中断服务程序的执行**：通过无条件转移指令（jump）使PC指向中断服务程序的入口地址。

## 总结区

本笔记总结了中断处理的基本流程、优先级管理、硬件排队器的工作原理以及中断服务程序的执行流程。重点包括：
- **中断优先级的设计原则**：硬件故障 > 非屏蔽中断 > DMA请求 > I/O设备中断。
- **硬件排队器**：通过飞门和宇门的组合处理中断信号，优先级更高的中断源优先输出1。
- **中断服务程序的执行流程**：保护现场、处理中断请求、恢复现场、开中断。

这些知识点是理解中断处理机制的核心，尤其在考试中常涉及中断优先级的设计和中断服务程序的执行流程。