# 总线仲裁机制

## 摘要

本节介绍了总线仲裁的基本概念、分类及其工作机制。总线仲裁用于解决多个设备同时请求使用总线时的优先级问题。集中仲裁方式包括链式查询、计数器查询和独立请求方式，而分布式仲裁则通过设备间的竞争决定优先级。每种仲裁方式都有其优缺点，适用于不同的应用场景。

## 主题

总线仲裁的核心在于解决多设备争用总线的问题，确保总线的有效使用。集中仲裁方式通过中央仲裁器协调设备请求，而分布式仲裁则通过设备间的竞争决定优先级。

> 重点难点
>
> - 集中仲裁与分布式仲裁的区别
> - 链式查询、计数器查询和独立请求方式的工作原理及优缺点
> - 总线仲裁的优先级机制及其对系统性能的影响

## 线索区

### 总线仲裁的基本概念
- 总线是共享资源，同一时刻只能供一组设备使用。
- 当多个设备同时请求使用总线时，需通过仲裁机制决定优先级。
- 总线仲裁解决多设备争用总线的问题。

### 总线的基本结构和控制权分配
- 单总线结构中，CPU、主存和I/O设备通过系统总线连接。
- 系统总线包含数据总线、地址总线和控制总线。
- 设备通过控制总线请求总线使用权，获得控制权后成为主设备。
- 主设备通过地址总线选择与哪个设备进行数据交互，被选中的设备称为从设备。

### 总线仲裁的分类
- 总线仲裁分为集中仲裁和分布仲裁。
- 集中仲裁进一步分为链式查询、计数器定时查询和独立请求方式。

### 集中仲裁的工作流程
- 设备发出请求、总线控制器判优、分配控制权。
- 总线控制器通常集成在CPU或桥接器中，负责协调总线上设备的操作。
- 获得总线控制权的主设备可以开始传送数据。

### 链式查询仲裁方式
- 链式查询方式通过三条信号线（BS、BR、BG）实现仲裁。
- 设备通过BR信号线发送请求，总线控制器通过BG信号线发送允许信号。
- 总线控制器通过BG信号线依次查询设备，第一个请求的设备获得控制权。
- 设备1获得总线控制权后，通过BS信号线发送总线忙信号。

### 计数器查询方式
- 计数器查询方式通过计数器逐个询问设备是否请求总线。
- 计数器从0开始计数，询问每个设备是否请求总线。
- 计数器的计数方式有多种，如每次从0开始计数或从上一次计数的位置继续。

### 独立请求方式
- 每个设备与控制部件之间有一根BR（请求线）和一根BG（总线允许信号线）。
- 当多个设备同时请求总线时，控制部件内的排队器决定优先分配总线控制权给哪个设备。
- 独立请求方式的优点是响应速度快，适合高优先级设备的快速响应。

### 分布式仲裁方式
- 分布式仲裁方式不需要中央仲裁器，每个设备有自己的仲裁器和仲裁号。
- 多个设备通过竞争使用总线，优先级高的仲裁号保留在仲裁总线上。

## 总结区

总线仲裁机制是确保多个设备有效共享总线的关键技术。集中仲裁方式通过中央仲裁器协调设备请求，包括链式查询、计数器查询和独立请求方式，各有其优缺点。分布式仲裁方式则通过设备间的竞争决定优先级，适用于高灵活性和高响应速度的场景。理解不同仲裁方式的工作原理及其优缺点，对于设计高效的总线系统至关重要。