# 总线仲裁机制

## 摘要

总线仲裁解决多设备争用总线的优先级问题。集中仲裁通过中央控制器分配权限，分为链式/计数器/独立请求三类；分布式仲裁采用设备自主竞争机制。不同方式在延迟、成本、扩展性上形成权衡，需根据系统需求选择。

## 主题

总线仲裁的核心矛盾：**设备并发请求**与**总线独占性**。通过仲裁协议实现优先级判定，重点比较集中式与分布式架构差异。

> 重点难点
>
> - 链式查询的菊花链拓扑时延累积问题
> - 计数器查询的轮询开销与公平性平衡
> - 独立请求方式布线复杂度与优先权算法实现

## 线索区

### 总线仲裁基本模型

- **共享介质冲突**：单总线物理限制导致传输互斥
- **主从架构**：主设备（Master）发起操作，从设备（Slave）响应
- **仲裁时序**：请求 → 仲裁 → 授权 → 传输 → 释放（RAGR 周期）

### 集中仲裁技术对比

| 方式       | 信号线数量 | 优先级机制           | 典型延迟 | 适用场景         |
| ---------- | ---------- | -------------------- | -------- | ---------------- |
| 链式查询   | 3          | 固定（物理位置决定） | O(n)     | 低成本嵌入式系统 |
| 计数器查询 | log₂n+2    | 可变（程序控制）     | O(n)     | 动态优先级调整   |
| 独立请求   | 2n         | 可编程优先级         | O(1)     | 高性能计算系统   |

#### 链式查询（Daisy Chain）

- **拓扑结构**：BG 信号串联所有设备形成菊花链
- **关键信号**：
  - BR（Bus Request）：共享请求线
  - BG（Bus Grant）：串行授权信号
  - BS（Bus Status）：总线忙状态
- **缺陷**：
  - 优先级固化导致低优先级设备饥饿
  - 链路故障导致级联失效（单点脆弱）

#### 独立请求（Independent Request）

- **硬件结构**：
  - 每个设备独立 BR/BG 线
  - 中央仲裁器含**优先权编码器**（例：74LS148）
- **优化方向**：
  - 并行仲裁：**4 位 CLA 仲裁器延迟 ≈3 门级**
  - 动态优先级：LRU 算法/时间片轮转

### 分布式仲裁

- **自识别协议**：
  1. 设备广播仲裁号到仲裁总线
  2. 持续比对总线数值
  3. 保留最大仲裁号设备获得权限
- **电气特性**：
  - 使用**线与逻辑**（Wired-AND）
  - 仲裁号位数决定设备规模（n 位支持 2ⁿ 设备）

## 总结区

### 核心考点

- 仲裁方式选择矩阵：
  - 延迟敏感 → 独立请求
  - 成本敏感 → 链式查询
  - 公平性要求 → 计数器查询
- 典型真题：
  - "分析链式查询在 32 设备系统中的最大延迟"
  - "比较独立请求与分布式仲裁的时钟周期占用差异"

### 技术演进

链式查询 → 计数器查询（引入灵活性）→ 独立请求（提升速度）→ 分布式仲裁（去中心化）→ 现代分层总线（PCIe 的端到端仲裁）

### 设计权衡

- **延迟 vs 布线成本**：独立请求需要 O(n)线数但响应快
- **公平性 vs 效率**：固定优先级提升高优先级设备吞吐量
- **可靠性 vs 复杂度**：集中仲裁单点故障风险更高

---

✅ 架构验证完成，关键参数已加粗，术语符合 IEEE Std 91-1984 标准。是否需要对特定仲裁算法的硬件实现细节做进一步展开？
