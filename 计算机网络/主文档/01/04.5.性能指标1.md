# 网络性能指标：速率、带宽与吞吐量

## 摘要

本课程解析速率、带宽、吞吐量的核心差异及测量方法，通过协议分层定位、实验验证和现实类比，构建可验证的性能评估体系。结合抓包命令与设备配置演示指标间的动态关系。

---

## 主题

**分层度量体系**：物理层带宽（信道容量）→ 数据链路层速率（接口比特率）→ 传输层吞吐量（端到端有效载荷）

> 重点难点
>
> - **带宽时延积**的管道模型类比（灌水实验验证）
> - **有效吞吐量**与协议开销的关系（TCP/IP 头部占比计算）
> - **速率单位陷阱**：bit vs Byte 的工程换算（数据表误解案例）

---

计算时延

## 线索区

### 物理层/带宽

```latex
信道容量公式（奈奎斯特准则）:
C = 2B \log_2(M) \quad (\text{B:带宽, M:调制电平数})
```

- **实验验证**：

  ```bash
  # 千兆以太网带宽测试（Linux）
  iperf3 -c 10.0.0.2 -t 30 -P 8 | grep sender
  # Windows 兼容方案
  jperf -c 10.0.0.2 -t 30 -i 1
  ```

- **抓包标识**：  
  Wireshark 统计图 → I/O Graph 显示**瞬时带宽**

### 数据链路层/速率

#### 比特填充时间计算

$$
t_{\text{bit}} = \frac{1}{R} \quad (R: 标称速率)
$$

- **MTU 关联**：  
  以太网**1500 字节**帧在 1Gbps 链路的传输耗时：  
$$ t = \frac{1500 \times 8}{10^9} = 12\mu s $$
- **故障案例**：  
  误配速率导致 CRC 错误（`ethtool`显示**协商速率**异常）

### 传输层/吞吐量

理论最大吞吐量:

$$
Throughput_{\text{max}} = \frac{W_{\text{cwnd}}}{RTT} \times MSS
$$

- **TCP 窗口验证**：

  ```bash
  # 查看当前拥塞窗口（Linux）
  ss -ti | grep cwnd
  # 关键抓包过滤式
  tshark -r trace.pcap -Y "tcp.analysis.bytes_in_flight"
  ```

- **协议开销对比**：  

  | 协议 | 头部开销 | 载荷效率（1500B MTU） |
  |--------|----------|-----------------------|
  | TCP/IP | 40B | 1460/1500=97.3% |
  | UDP/IP | 28B | 1472/1500=98.1% |

---

## 总结区

### 核心关联

- **带宽时延积** = 带宽 × RTT → 决定**管道容量**
- **有效吞吐量** = 应用层数据量 / 总传输时间 → 反映协议效率

### 实验重点

1. **带宽验证**：`iperf3`多流测试突破中间件限速
2. **速率协商**：`ethtool -S eth0`查看**错包计数**
3. **吞吐瓶颈**：Wireshark 的**TCP Stream Graph**分析传输波动

### 故障模式

- **速率不匹配**：物理层 CRC 错误激增
- **带宽过载**：TCP 重传率>5%
- **吞吐塌陷**：小窗口问题（`net.ipv4.tcp_rmem`调优）

---

**下一阶段**：结合 BDP（Bandwidth-Delay Product）分析卫星链路性能优化策略，实验环节将使用 NetEm 模拟高延迟环境。
