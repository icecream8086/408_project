# 数据交换方式

## 摘要

本课程系统解析电路交换、报文交换与分组交换三大数据交换机制，通过协议分层框架对比技术特性，结合存储转发原理与虚电路实现，构建可抓包验证的网络传输分析模型。

## 主题

网络通信基础架构的核心数据交换范式对比，重点揭示存储转发技术演进对网络性能的影响机制。涉及物理层连接建立、传输层流量控制与网络层分组路由等关键技术点。

> 重点难点
> 
> - 电路交换时延模型：**连接建立时延** vs 数据传输时延
> - 存储转发机制数学验证：分组交换总时延公式推导
> - 虚电路标识符（VCID）与数据报地址寻址的本质区别
> - BGP路由震荡场景下的交换方式选择策略

## 线索区

### 知识点1：电路交换协议栈
**物理层特性**
- **连接建立流程**（物理层）：
  ``` 
  CALL REQUEST → [路由选择] → CALL ACK
  ```
- 时延构成公式：
  $$
  T_{total} = T_{setup} + \frac{L}{B} + T_{release}
  $$
- **抓包特征**：持续固定带宽占用，Wireshark显示连续RTP流（语音视频场景）

### 知识点2：报文交换状态机
**应用层实现**
- 存储转发状态转换：
  ```
  [接收报文] → [CRC校验] → [缓冲区排队] → [路由选择] → [转发]
  ```
- **tcpdump观测**：`tcpdump -i eth0 -s 0 -w message_swap.pcap` 捕获不定长报文
- 性能瓶颈：缓冲区溢出导致报文丢失（需监控`/proc/net/dev`的drop计数器）

### 知识点3：分组交换优化
**网络层核心机制**
- 分组结构（以太网帧示例）：
  ```
  | 前导码 | 目的MAC | 源MAC | 类型 | 数据（MTU **1500**） | FCS |
  ```
- 时延计算公式（N跳传输）：
  $$
  D_{total} = N \times (\frac{P}{R} + T_{proc})
  $$
- **Wireshark过滤**：`ip.src == 192.168.1.1 && tcp.len > 500`

### 知识点4：虚电路信令协议
**传输层会话管理**
- 信令交互流程（类TCP三次握手）：
  ```
  SETUP → CONNECT → ACK
  ```
- 路由表项特征（Cisco示例）：
  ```cisco
  interface Serial0/0
   frame-relay interface-dlci 102
   protocol ip 10.1.1.2
  ```
- 故障场景：链路中断导致`CLEAR_REQUEST`信令风暴（可配置BFD快速检测）

## 总结区

**核心考点矩阵**：
| 交换类型 | 时延特性 | 可靠性 | 典型协议 |
|---------|----------|--------|----------|
| 电路交换 | 固定带宽 | 高 | PSTN,ISDN |
| 报文交换 | 可变时延 | 中 | SMTP,FTP |
| 分组交换 | 统计复用 | 可变 | IP,Ethernet |

**实验验证建议**：
1. 使用`mgen`工具生成流量模式对比交换性能
2. 通过`tc qdisc`模拟不同网络时延场景
3. 抓包分析HTTP/2流复用与虚电路的异同

**故障排查重点**：
- 分组乱序：检查`tshark -T fields -e tcp.analysis.out_of_order`
- 虚电路中断：跟踪`frDebug`日志中的LMI状态机变化
- 缓冲区膨胀：监控`netstat -s`中的`packet reassembles failed`