# 快表（TLB）与地址变换

## 摘要

快表（TLB）通过缓存页表项加速地址变换，基于局部性原理实现高命中率（>90%），使平均访问耗时从 100μs 降至 111μs（命中率 90%时）。系统采用多级存储结构（硬盘 → 内存 → 高速缓存 →TLB）实现性能与成本的最优平衡。

---

## 主题

**核心方法**：通过高速缓存（TLB）减少内存访问次数  
**技术路径**：时间/空间局部性 →TLB 缓存策略 → 多级存储协同  
**关键词**：TLB 命中率、地址变换延迟、存储层次结构

> 高频问题提示：
>
> - 进程切换为何需清空 TLB？
> - 如何量化 TLB 对系统性能的提升？

---

## 线索区

### 知识点 1：TLB 基本架构

> **定义**

- TLB（Translation Lookaside Buffer）：专用硬件缓存，存储**最近访问的页表项**
- 访问速度：**1μs**（vs 内存访问 100μs）

> **工作原理**

1. CPU 生成逻辑地址
2. 优先查询 TLB
3. 命中 → 直接获取物理地址
4. 未命中 → 访问内存页表 → 更新 TLB

> **电路特性**

- 采用**SRAM**实现（比 DRAM 更快但成本更高）
- 典型容量：64-1024 条目（远小于内存页表）

---

### 知识点 2：局部性原理与命中率

> **数学表达**

- 平均访问时间 = TLB 命中率 ×TLB 延迟 + (1-命中率)× 内存延迟
- 例：命中率 90%时，$T_{avg} = 0.9×1μs + 0.1×100μs = 10.9μs$

**关键机制**  

| 局部性类型 | 作用机制 | 现实类比 |  
|------------|--------------------------|-----------------------|  
| 时间局部性 | 重复访问相同页表项 | 办公室常用文件放桌面 |  
| 空间局部性 | 连续访问相邻内存页 | 图书馆相邻书架集中检索|

> **性能数据**

- 典型 TLB 命中率：**90-99%**
- Pentium 处理器 TLB：64 条目 → 覆盖**256KB**内存空间

---

### 知识点 3：存储层次结构优化

**性能-成本矩阵**  

| 存储层级 | 访问延迟 | 容量 | 成本/$/GB |  
|----------|----------|---------|-----------|  
| HDD | 10ms | 1-10TB | 0.02 |  
| RAM | 100ns | 8-64GB | 3 |  
| L3 Cache | 10ns | 8-32MB | 30 |  
| TLB | 1ns | 64-1024 | 100+ |

> **设计权衡**

- 速度每提升 10 倍 → 成本增加约 10 倍
- 容量每增加 10 倍 → 访问延迟增加约 5 倍

---

## 总结区

> **核心结论**

1. TLB 通过空间换时间策略，将地址变换延迟降低**1-2 个数量级**
2. 存储层次结构遵循「访问频率越高 → 存储层级越高」的设计原则

> **考点映射**

- 计算不同命中率下的平均访问时间（公式应用）
- 分析进程切换导致 TLB 清空对性能的影响（OS 进程管理考点）
- 对比 SRAM/DRAM 在 TLB 实现中的优劣（组成原理考点）

> **实验验证建议**

- 使用 Valgrind 工具模拟不同 TLB 大小对程序性能的影响
- 通过`perf stat`命令实测 TLB 缺失率
