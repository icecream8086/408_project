# 进程控制与状态转换

## 摘要

本视频讲解了进程控制的基本概念、状态转换的实现、言语的原子性、特权指令的使用限制以及进程的创建、撤销、阻塞、唤醒和切换等操作。通过这些内容，深入理解了操作系统如何管理进程并确保系统的稳定性和效率。

## 主题

进程控制涉及创建、撤销、阻塞、唤醒和切换等操作，核心在于通过言语（元语）实现进程状态转换的原子性。关键词包括：进程控制、状态转换、言语、原子性、特权指令、PCB、阻塞、唤醒、切换。

> 重点难点
>
> - 进程状态转换的原子性实现
> - 特权指令（关中断和开中断）的使用限制
> - 进程创建和撤销的具体操作
> - 进程切换时的运行环境保存与恢复

## 线索区

### 进程控制的基本概念
- 进程控制的主要功能是对系统中的所有进程进行有效管理。
- 包括创建新进程、撤销已有进程、实现进程状态转换等功能。
- 核心是实现进程的状态转换，如从无到有、从创建态到就绪态。

### 进程状态转换的实现
- 进程状态转换时，操作系统需要执行一系列操作，这些操作必须一气呵成。
- 使用“言语”这种特殊的程序来实现进程状态转换，言语具有原子性，执行过程不可中断。
- 进程状态转换需要一气呵成的原因：避免关键数据结构信息不统一，导致系统出错。

### 言语的原子性实现
- 言语的原子性通过关中断和开中断这两个特权指令实现。
- 关中断指令使CPU不再检查中断信号，确保指令序列的执行不被中断。
- 开中断指令恢复CPU检查中断信号的习惯，确保中断信号在适当时候被处理。

### 特权指令的使用限制
- 关中断和开中断指令是特权指令，只能由内核程序使用，普通用户程序不能使用。
- 如果普通用户程序使用这些指令，可能导致程序一直霸占CPU，不被中断，这是不允许的。

### 进程创建
- 创建言语用于实现进程的创建。
- 创建进程时，操作系统必须使用创建言语。
- 创建言语会申请空白PCB，分配资源，初始化PCB内容，并将其插入就绪队列。
- 典型事件如用户登录、作业调度、进程请求等会触发进程创建。

### 进程撤销
- 撤销言语用于终止进程。
- 撤销言语使进程从某状态转向终止态，最终从系统中消失。
- 撤销言语需要找到进程的PCB，剥夺CPU使用权，杀死子进程，归还资源，并删除PCB。

### 进程阻塞和唤醒
- 阻塞言语和唤醒言语的作用。
- 进程从运行态进入阻塞态时，操作系统执行阻塞言语。
- 阻塞进程需要找到PCB，保护运行现场，设置状态为阻塞态，并将其插入等待队列。
- 进程被唤醒时，状态从阻塞态回到就绪态。

### 进程切换
- 切换言语用于让当前运行的进程下处理机，回到就绪队列，并选择另一个就绪态的进程上处理机运行。
- 切换言语需要保存当前进程的运行环境信息到PCB中，并将PCB移到相应的队列。
- 切换言语还会挑选一个进程上处理机运行，并更新其PCB内容，同时恢复该进程的运行环境。

### CPU寄存器和进程运行环境
- CPU在执行指令时，会使用多个寄存器来存放指令和数据，如程序状态字寄存器（PSW）、程序计数器（PC）、指令寄存器（IR）等。
- PSW寄存器保存CPU的状态信息（内核态或用户态），PC寄存器存放下一条要执行的指令地址，IR寄存器存放当前正在执行的指令。
- 通用寄存器用于存放临时数据，如变量X的值。

### 进程切换时的寄存器保存与恢复
- 当进程切换时，当前进程的运行环境信息（如寄存器内容）会被保存到PCB中，以便在进程重新运行时恢复。
- 保存的运行环境信息包括PSW、PC和通用寄存器的内容，确保进程在重新运行时能够继续执行未完成的任务。
- 当进程重新上处理机时，操作系统会根据PCB中保存的信息恢复其运行环境，确保进程能够继续执行后续指令。

## 总结区

本节内容详细介绍了进程控制与状态转换的实现机制，重点包括进程的创建、撤销、阻塞、唤醒和切换等操作。通过言语（元语）的原子性实现，操作系统能够确保进程状态转换的正确性和一致性。特权指令的使用限制进一步保障了系统的稳定性。理解这些过程有助于深入掌握操作系统的核心机制，特别是在进程管理和处理机管理方面的应用。